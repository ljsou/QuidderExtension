/** * Created by Javier on 29/10/03. */// This callback function is called when the content script has been// injected and returned its resultsfunction onPageInfo(o)  {    console.log("popup - onPageInfo");    document.getElementById("currentLink").value = o.title;    document.getElementById("url").value = o.url;    document.getElementById("summary").innerText = o.summary;}// POST the data to the server using XMLHttpRequestfunction addBookmark() {    console.log("popup - addBookmark");    var postUrl = "http://localhost:8084/QuidderExServer/faces/index.xhtml";    var xhr = new XMLHttpRequest();    // xhr.open("POST", postUrl, true);    // Non-asynchronous request works fine    xhr.open("POST", postUrl, false);    var params =  "&url=" + document.getElementById("url").value +        "&summary=" + document.getElementById("summary").value;    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");    xhr.send(params);    var getUrl = "http://localhost:8084/QuidderExServer/faces/index.xhtml";    var xhReq = new XMLHttpRequest();    xhReq.open("GET", getUrl, false);    // This async request used to work, but now doesn't for some reason...    // It works if you 'Inspect popup' and step through the code in the Chrome debugger,    // but as soon as you close the debugger and try the same thing, the call fails?!??    xhReq.onreadystatechange = function() {        // If the request completed, close the extension popup        console.log(xhReq.readyState);        if (xhReq.readyState == 4) {            console.log(xhReq.status);            if (xhReq.status == 200){                var serverResponse = xhReq.statusText;                console.log("chido 200: " + serverResponse);                alert("chido 200: " + xhReq.statusText);                //window.close();            }if(xhReq.status == 202){                //alert("chido " + xhReq.responseText );                alert("chido 202: " + xhReq.statusText + " - " + xhReq.getAllResponseHeaders() + " -> " + xhReq.getResponseHeader("nombre"));                console.log("status: " + xhReq.statusText + " a header:  " + xhReq.getResponseHeader("nombre"));            }        }    };    xhReq.send(null);    //window.close();    return false;}// When the popup HTML has loadedwindow.addEventListener("load", function(evt) {    console.log("popup - addEventListener");    // Handle the bookmark form submit event with our addBookmark function    document.getElementById('addbookmark').addEventListener('submit', addBookmark);    document.getElementById('save').addEventListener('click', function(){        //var newURL = "http://localhost:8084/QuidderExServer/faces/index.xhtml   ";        //chrome.tabs.create({ url: newURL });    })    // Call the getPageInfo function in the background page, injecting content_script.js    // into the current HTML page and passing in our onPageInfo function as the callback    //chrome.extension.getBackgroundPage().getPageInfo(onPageInfo);});